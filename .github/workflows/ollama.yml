name: Run Ollama Python App (Branch Only)

on:
  push:
    branches:
      - ollama-tests

jobs:
  run-with-conda:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Conda environment
      uses: conda-incubator/setup-miniconda@v3
      with:
        miniforge-variant: Miniforge3
        miniforge-version: latest
        use-mamba: true
        environment-file: backend/environment.yml
        activate-environment: backend
        channels: conda-forge,defaults
        auto-activate-base: false

    - name: Run Python app
      shell: bash -l {0}
      run: |
        python3 backend/main.py \
          --model 5 \
          --source_code ./python-test-cases/test_case_four.py \
          --modules calculate_mcc text_converter calculate_ccc context_size_calculator metrics_collector
    
        cat outputs/latest/metrics.json

        
        
