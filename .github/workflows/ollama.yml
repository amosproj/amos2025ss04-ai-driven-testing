name: Run Ollama Python App (Branch Only)

on:
  push:
    branches:
      - ollama-tests
  workflow_dispatch:

jobs:
  run-with-conda:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up Conda environment
      uses: conda-incubator/setup-miniconda@v3
      with:
        miniforge-variant: Miniforge3
        miniforge-version: latest
        use-mamba: true
        environment-file: backend/environment.yml
        activate-environment: backend
        channels: conda-forge,defaults
        auto-activate-base: false

    - name: Run Python app (spins up Docker itself)
      shell: bash -l {0}  # needed for Conda env
      run: |
        python3 backend/main.py --model 5 --modules internet_search --use-links https://www.bbc.com/news/articles/cjrld3erq4eo
